## @section Nextcloud parameters

## @param enabled Whether to enable Nextcloud.
## @param replicaCount The number of replicas to deploy.
## @param image.repository The Docker repository to pull the image from.
## @param image.tag The image tag to use.
## @param image.pullPolicy The logic of image pulling.
## @param imagePullSecrets The image pull secrets to use.
## @param deployment.strategy.type The deployment strategy to use.
## @param serviceAccount.create Whether to create a service account.
## @param serviceAccount.annotations Additional annotations to add to the service account.
## @param serviceAccount.name The name of the service account to use. If not set and create is true, a new service account will be created with a generated name.
## @param podAnnotations Additional annotations to add to the pod.
## @param podSecurityContext The security context to use for the pod.
## @param securityContext The security context to use for the container.
## @param initContainers Additional init containers to add to the pod.
## @param service.type The type of service to create.
## @param service.port The port on which the service will run.
## @param service.nodePort The nodePort to use for the service. Only used if service.type is NodePort.
## @param ingress.enabled Whether to create an ingress for the service.
## @param ingress.className The ingress class name to use.
## @param ingress.annotations Additional annotations to add to the ingress.
## @param ingress.hosts[0].host The host to use for the ingress.
## @param ingress.hosts[0].paths[0].path The path to use for the ingress.
## @param ingress.hosts[0].paths[0].pathType The path type to use for the ingress.
## @param ingress.tls The TLS configuration for the ingress.
## @param resources The resources to use for the pod.
## @param autoscaling.enabled Whether to enable autoscaling.
## @param autoscaling.minReplicas The minimum number of replicas to scale to.
## @param autoscaling.maxReplicas The maximum number of replicas to scale to.
## @param autoscaling.targetCPUUtilizationPercentage The target CPU utilization percentage to use for autoscaling.
## @param autoscaling.targetMemoryUtilizationPercentage The target memory utilization percentage to use for autoscaling.
## @param nodeSelector The node selector to use for the pod.
## @param tolerations The tolerations to use for the pod.
## @param affinity The affinity to use for the pod.
## @param env.NEXTCLOUD_ADMIN_USER The admin username.
## @param env.NEXTCLOUD_ADMIN_PASSWORD The admin password.
## @param env.NEXTCLOUD_TRUSTED_DOMAINS Trusted domains for Nextcloud.
## @param database.enabled Whether to enable PostgreSQL database for Nextcloud.
## @param database.name Name of the database cluster (will be suffixed with release name).
## @param database.instances Number of PostgreSQL instances (replicas).
## @param database.image.repository PostgreSQL container image repository.
## @param database.image.tag PostgreSQL container image tag.
## @param database.database Name of the database to create.
## @param database.owner Owner of the database.
## @param database.storage.size Size of the storage for each instance.
## @param database.storage.storageClass Storage class name for persistent volumes.
## @param database.secret.name Name of the secret containing database credentials.
## @param database.secret.create Whether to create the database secret.
## @param database.secret.username Database user username.
## @param database.secret.password Database user password (leave empty to auto-generate).
## @param database.superuserSecret.name Name of the secret containing the superuser credentials.
## @param database.superuserSecret.create Whether to create the superuser secret.
## @param database.superuserSecret.username Superuser username.
## @param database.superuserSecret.password Superuser password (leave empty to auto-generate).
## @param persistence.enabled Whether to enable persistence.
## @param persistence.storageClass The storage class to use for the persistence.
## @param persistence.existingClaim The name of an existing claim to use for the persistence.
## @param persistence.accessMode The access mode to use for the persistence.
## @param persistence.size The size to use for the persistence.
## @param persistence.backup.enabled Whether to enable backup persistence.
## @param persistence.backup.storageClass The storage class to use for backup persistence.
## @param persistence.backup.existingClaim The name of an existing claim to use for backup persistence.
## @param persistence.backup.accessMode The access mode to use for backup persistence.
## @param persistence.backup.size The size to use for backup persistence.
## @param persistence.additionalVolumes Additional volumes to add to the pod.
## @param persistence.additionalMounts Additional volume mounts to add to the pod.
##
enabled: true
replicaCount: 1

image:
  repository: docker.io/library/nextcloud
  pullPolicy: IfNotPresent
  tag: "32.0.3"

imagePullSecrets: []

deployment:
  strategy:
    type: Recreate

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

initContainers: []
  # - name: init-container
  #   image: busybox
  #   command: ['sh', '-c', 'echo "this is an init container"']

service:
  type: LoadBalancer
  port: 80
  nodePort: ""

ingress:
  enabled: true
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local

resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}

env:
  NEXTCLOUD_ADMIN_USER: "admin"
  NEXTCLOUD_ADMIN_PASSWORD: "admin"
  NEXTCLOUD_TRUSTED_DOMAINS: "localhost"
  # Database and cache connection will be configured via secrets when enabled
  # Otherwise, configure these manually for external services

## @section DragonflyDB parameters
## DragonflyDB provides Redis-compatible caching for Nextcloud

## @param dragonfly.mode The mode of DragonflyDB deployment: 'standalone', 'cluster', 'external', or 'disabled'.
## @param dragonfly.standalone.image.repository The Docker repository for Dragonfly image.
## @param dragonfly.standalone.image.tag The image tag for Dragonfly.
## @param dragonfly.standalone.resources Resource limits and requests for standalone Dragonfly.
## @param dragonfly.standalone.persistence.enabled Whether to enable persistence for standalone Dragonfly.
## @param dragonfly.standalone.persistence.size Size of the persistence volume for standalone Dragonfly.
## @param dragonfly.standalone.persistence.storageClass Storage class for standalone Dragonfly persistence.
## @param dragonfly.cluster.replicas Number of Dragonfly replicas in the cluster.
## @param dragonfly.cluster.image.repository The Docker repository for Dragonfly cluster image.
## @param dragonfly.cluster.image.tag The image tag for Dragonfly cluster.
## @param dragonfly.cluster.resources Resource limits and requests for Dragonfly cluster.
## @param dragonfly.cluster.persistence.enabled Whether to enable persistence for Dragonfly cluster.
## @param dragonfly.cluster.persistence.size Size of the persistence volume for Dragonfly cluster.
## @param dragonfly.cluster.persistence.storageClass Storage class for Dragonfly cluster persistence.
## @param dragonfly.external.host Hostname of external DragonflyDB/Redis (when mode is 'external').
## @param dragonfly.external.port Port of external DragonflyDB/Redis.
## @param dragonfly.external.existingSecret Secret name for external DragonflyDB/Redis password.
## @param dragonfly.external.passwordKey Key in the secret for the password.
##
dragonfly:
  # Mode options: 'standalone', 'cluster', 'external', or 'disabled'
  # Set to 'disabled' if you don't need Redis caching for Nextcloud
  mode: disabled

  # Standalone Dragonfly deployment (simple single-instance)
  standalone:
    image:
      repository: docker.dragonflydb.io/dragonflydb/dragonfly
      tag: "v1.25.2"
    resources: {}
      # limits:
      #   cpu: 1000m
      #   memory: 2Gi
      # requests:
      #   cpu: 100m
      #   memory: 256Mi
    persistence:
      enabled: true
      size: 5Gi
      storageClass: ""

  # Dragonfly Cluster deployment (using DragonflyDB operator)
  cluster:
    replicas: 2
    image:
      repository: docker.dragonflydb.io/dragonflydb/dragonfly
      tag: "v1.25.2"
    resources: {}
      # limits:
      #   cpu: 2000m
      #   memory: 4Gi
      # requests:
      #   cpu: 500m
      #   memory: 512Mi
    persistence:
      enabled: true
      size: 5Gi
      storageClass: ""

  # External DragonflyDB/Redis configuration (used when mode is 'external')
  external:
    host: ""
    port: 6379
    existingSecret: ""
    passwordKey: "password"

# Database configuration
## @param database.mode The mode of PostgreSQL deployment: 'standalone', 'cluster', or 'external'.
## @param database.standalone.enabled Whether to deploy standalone PostgreSQL using Bitnami subchart.
## @param database.standalone.auth.database Name of the default database.
## @param database.standalone.auth.username Username for the default database.
## @param database.standalone.auth.password Password for the default database user.
## @param database.standalone.auth.postgresPassword Password for the 'postgres' administrative user.
## @param database.standalone.auth.existingSecret Reference to an existing Kubernetes secret containing the database credentials.
## @param database.standalone.image.registry PostgreSQL image registry.
## @param database.standalone.image.repository PostgreSQL image repository.
## @param database.standalone.image.tag PostgreSQL image tag.
## @param database.standalone.primary.persistence.enabled Whether to enable persistence for PostgreSQL.
## @param database.standalone.primary.persistence.size Size of the PostgreSQL persistence volume.
## @param database.standalone.primary.persistence.storageClass Storage class for PostgreSQL persistence.
## @param database.cluster.enabled Whether to deploy PostgreSQL using CloudNativePG operator.
## @param database.cluster.name Name of the database cluster.
## @param database.cluster.instances Number of PostgreSQL instances (replicas).
## @param database.cluster.image.repository PostgreSQL container image repository.
## @param database.cluster.image.tag PostgreSQL container image tag.
## @param database.cluster.database Name of the database to create.
## @param database.cluster.owner Owner of the database.
## @param database.cluster.storage.size Size of the storage for each instance.
## @param database.cluster.storage.storageClass Storage class name for persistent volumes.
## @param database.cluster.secret.name Name of the secret containing database credentials.
## @param database.cluster.secret.create Whether to create the database secret.
## @param database.cluster.secret.username Database user username.
## @param database.cluster.secret.password Database user password (leave empty to auto-generate).
## @param database.cluster.superuserSecret.name Name of the secret containing the superuser credentials.
## @param database.cluster.superuserSecret.create Whether to create the superuser secret.
## @param database.cluster.superuserSecret.username Superuser username.
## @param database.cluster.superuserSecret.password Superuser password (leave empty to auto-generate).
## @param database.external.host Hostname of external PostgreSQL (when mode is 'external').
## @param database.external.port Port of external PostgreSQL.
## @param database.external.database Database name of external PostgreSQL.
## @param database.external.username Username of external PostgreSQL.
## @param database.external.existingSecret Secret name for external PostgreSQL password.
## @param database.external.secretKey Key in the secret for the password.
database:
  # Mode options: 'standalone', 'cluster', or 'external'
  mode: cluster

  # Standalone PostgreSQL deployment (using Bitnami subchart)
  # Note: Values here are for reference only. Actual subchart values are under 'postgresql-standalone:' below
  standalone:
    enabled: false
    auth:
      database: nextcloud
      username: nextcloud
      password: ""
      postgresPassword: ""
      existingSecret: ""
    primary:
      persistence:
        enabled: true
        size: 10Gi
        storageClass: "ceph-rbd"

  # CloudNativePG Cluster deployment (using CNPG operator) - original configuration
  cluster:
    enabled: true
    name: nextcloud-db
    instances: 1
    image:
      repository: ghcr.io/cloudnative-pg/postgresql
      tag: "16.6"
    database: nextcloud
    owner: nextcloud
    storage:
      size: 10Gi
      storageClass: "ceph-rbd"
    secret:
      name: ""  # Leave empty to auto-generate
      create: true
      username: nextcloud
      password: ""  # Leave empty to auto-generate
    superuserSecret:
      name: ""  # Leave empty to auto-generate
      create: true
      username: postgres
      password: ""  # Leave empty to auto-generate

  # External PostgreSQL configuration (used when mode is 'external')
  external:
    host: ""
    port: 5432
    database: "nextcloud"
    username: "nextcloud"
    existingSecret: ""
    secretKey: "password"

persistence:
  enabled: true
  storageClass: "ceph-rbd"
  existingClaim: ""
  accessMode: ReadWriteOnce
  size: 10Gi
  backup:
    enabled: false
    storageClass: "cephfs"
    existingClaim: ""
    accessMode: ReadWriteMany
    size: 10Gi
  additionalVolumes: []
  additionalMounts: []


## @section ArgoCD Image Updater parameters

## @param imageUpdater.enabled Enable ArgoCD Image Updater integration. Creates an ImageUpdater CRD for automatic image updates.
## @param imageUpdater.namespace Namespace where the ImageUpdater CRD will be created.
## @param imageUpdater.argocdNamespace Namespace where ArgoCD Applications are located.
## @param imageUpdater.applicationName Name or pattern of the ArgoCD Application to update. Defaults to Release name.
## @param imageUpdater.imageAlias Alias for the image in the ImageUpdater CRD. Defaults to Release name.
## @param imageUpdater.updateStrategy Strategy for image updates (semver, latest, newest-build, name, alphabetical, digest).
## @param imageUpdater.forceUpdate Force update even if image is not currently deployed.
## @param imageUpdater.allowTags Match function for allowed tags (e.g., "regexp:^[0-9]+\\.[0-9]+\\.[0-9]+$" or "any").
## @param imageUpdater.ignoreTags List of glob patterns to ignore specific tags.
## @param imageUpdater.pullSecret Reference to secret for private registry authentication.
## @param imageUpdater.platforms List of target platforms (e.g., ["linux/amd64", "linux/arm64"]).
## @param imageUpdater.helm Helm-specific configuration for parameter names (e.g., {name: "image.repository", tag: "image.tag"}).
## @param imageUpdater.kustomize Kustomize-specific configuration (e.g., {name: "original/image"}).
## @param imageUpdater.writeBackConfig Write-back configuration for GitOps.
##
imageUpdater:
  enabled: false
  namespace: argocd
  argocdNamespace: argocd
  applicationName: ""
  imageAlias: ""
  updateStrategy: semver
  forceUpdate: false
  allowTags: ""
  ignoreTags: []
  pullSecret: ""
  platforms: []
  helm: {}
  kustomize: {}
  writeBackConfig: {}

## @section PostgreSQL Subchart Configuration (Bitnami)
## These values are passed to the postgresql-standalone subchart when database.mode is 'standalone'
## See https://github.com/bitnami/charts/tree/main/bitnami/postgresql for all options
##
postgresql-standalone:
  # Values here are passed directly to the Bitnami PostgreSQL subchart
  # when database.standalone.enabled is true
  architecture: standalone
  auth:
    database: nextcloud
    username: nextcloud
    password: ""
    postgresPassword: ""
    existingSecret: ""
  primary:
    persistence:
      enabled: true
      size: 10Gi
      storageClass: "ceph-rbd"
