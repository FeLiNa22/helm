## Default values for n8n

## @section Image parameters

## @param image.repository The Docker repository to pull the image from.
## @param image.tag The image tag to use.
## @param image.pullPolicy The logic of image pulling.
## @param image.autoupdate.enabled Enable automatic image updates via ArgoCD Image Updater.
## @param image.autoupdate.strategy Strategy for image updates (semver, latest, newest-build, name, alphabetical, digest).
## @param image.autoupdate.allowTags Match function for allowed tags (e.g., "regexp:^[0-9]+\\.[0-9]+\\.[0-9]+$" or "any").
## @param image.autoupdate.ignoreTags List of glob patterns to ignore specific tags.
## @param image.autoupdate.pullSecret Reference to secret for private registry authentication.
## @param image.autoupdate.platforms List of target platforms (e.g., ["linux/amd64", "linux/arm64"]).
##
image:
  repository: n8nio/n8n
  tag: "latest"
  pullPolicy: IfNotPresent
  autoupdate:
    enabled: false
    strategy: ""
    allowTags: ""
    ignoreTags: []
    pullSecret: ""
    platforms: []

## @section Deployment parameters

## @param replicaCount The number of replicas to deploy.
##
replicaCount: 1

## @param n8n.protocol Protocol for n8n (http/https).
## @param n8n.port Port on which n8n will run.
## @param n8n.startCommand Command to start n8n (default includes sleep delay).
## @param n8n.persistence.enabled Whether to enable persistence for n8n data.
## @param n8n.persistence.storageClass The storage class to use for persistence.
## @param n8n.persistence.size Size of the persistence volume.
## @param n8n.persistence.existingClaim Use an existing PVC instead of creating a new one.
## @param n8n.persistence.mountPath Mount path for n8n data.
## @param n8n.initContainer.enabled Whether to enable the init container for volume permissions.
## @param n8n.initContainer.image Image for the init container.
## @param n8n.initContainer.tag Tag for the init container image.
## @param n8n.resources.requests.memory Memory request for n8n container.
## @param n8n.resources.limits.memory Memory limit for n8n container.
## @param n8n.nodeSelector Optional node selector to use.
## @param n8n.tolerations Whether to set node tolerations.
## @param n8n.affinity Whether to set node affinity.
##
n8n:
  protocol: http
  port: 5678
  startCommand: "sleep 5; n8n start"
  persistence:
    enabled: true
    storageClass: ""
    size: 512Mi
    existingClaim: ""
    mountPath: /home/node/.n8n
  initContainer:
    enabled: true
    image: busybox
    tag: "1.36"
  resources:
    requests:
      memory: "250Mi"
    limits:
      memory: "500Mi"
  nodeSelector: {}
  tolerations: []
  affinity: {}

## @section Velero Backup Schedule parameters

## @param velero.enabled Whether to enable Velero backup schedules
## @param velero.namespace The namespace where Velero is deployed (Schedule CRD must be created in Velero namespace)
## @param velero.schedule The cron schedule for Velero backups (e.g., "0 2 * * *" for 2am daily)
## @param velero.ttl Time to live for backups (e.g., "720h" for 30 days)
## @param velero.includeClusterResources Whether to include cluster-scoped resources in backup
## @param velero.snapshotVolumes Whether to take volume snapshots
## @param velero.defaultVolumesToFsBackup Whether to use file system backup for volumes by default
## @param velero.storageLocation The storage location for backups (leave empty for default)
## @param velero.volumeSnapshotLocations The volume snapshot locations (leave empty for default)
## @param velero.labelSelector Additional label selector to filter resources (optional)
## @param velero.annotations Additional annotations to add to the Velero Schedule resources
velero:
  enabled: false
  namespace: "velero"
  schedule: "0 2 * * *"
  ttl: "168h"
  includeClusterResources: false
  snapshotVolumes: true
  defaultVolumesToFsBackup: false
  storageLocation: ""
  volumeSnapshotLocations: []
  labelSelector: {}
  annotations: {}

## @section Environment Variables

## @param env Environment variables for n8n (use map format: key: value).
##
env: {}
  # GENERIC_TIMEZONE: "Europe/London"
  # N8N_METRICS: "true"

## @section Service parameters

## @param service.type The type of service to create.
## @param service.port The port on which the service will run.
##
service:
  type: ClusterIP
  port: 80

## @section Ingress parameters

## @param ingress.enabled Whether to enable the ingress.
## @param ingress.className The ingress class name to use.
## @param ingress.annotations Annotations for the Ingress resource.
## @param ingress.tls.enabled Enable TLS for the Ingress.
## @param ingress.tls.hosts List of hosts for which the TLS certificate is valid.
## @param ingress.hosts[0].host The host name that the Ingress will respond to.
## @param ingress.hosts[0].paths[0].path URL path for the HTTP rule.
## @param ingress.hosts[0].paths[0].pathType Type of path matching.
##
ingress:
  enabled: false
  className: ""
  annotations: {}
  tls:
    enabled: false
    hosts: []
  hosts:
    - host: n8n.local
      paths:
        - path: /
          pathType: Prefix

## @section Database parameters
## PostgreSQL database is required for n8n

## @param postgres.mode The mode of PostgreSQL deployment: 'standalone', 'cluster', or 'external'.
## @param postgres.type Database type (postgresdb, postgres, mysql, mariadb, sqlite).
## @param postgres.initSQL Array of SQL commands to run on database initialization.
## @param postgres.username Username for the database.
## @param postgres.database Database name for PostgreSQL.
## @param postgres.password.secretName Existing secret name for database password (mutually exclusive with value).
## @param postgres.password.secretKey Key in the secret containing the password (default: password).
## @param postgres.password.value Direct password value to create a secret (mutually exclusive with secretName).
## @param postgres.standalone.persistence.enabled Enable persistence for standalone PostgreSQL.
## @param postgres.standalone.persistence.size Size of the persistence volume.
## @param postgres.standalone.persistence.storageClass Storage class for persistence.
## @param postgres.standalone.persistence.existingClaim Use an existing PVC.
## @param postgres.standalone.image.repository PostgreSQL image repository.
## @param postgres.standalone.persistence.enabled Enable persistence for standalone PostgreSQL.
## @param postgres.standalone.persistence.size Size of the persistence volume.
## @param postgres.standalone.persistence.storageClass Storage class for persistence.
## @param postgres.standalone.persistence.existingClaim Use an existing PVC.
## @param postgres.standalone.image.tag PostgreSQL image tag.
## @param postgres.standalone.persistence.enabled Enable persistence for standalone PostgreSQL.
## @param postgres.standalone.persistence.size Size of the persistence volume.
## @param postgres.standalone.persistence.storageClass Storage class for persistence.
## @param postgres.standalone.persistence.existingClaim Use an existing PVC.
## @param postgres.standalone.image.autoupdate.enabled Enable automatic image updates for standalone database (default: false).
## @param postgres.standalone.persistence.enabled Enable persistence for standalone PostgreSQL.
## @param postgres.standalone.persistence.size Size of the persistence volume.
## @param postgres.standalone.persistence.storageClass Storage class for persistence.
## @param postgres.standalone.persistence.existingClaim Use an existing PVC.
## @param postgres.standalone.image.autoupdate.updateStrategy Strategy for image updates (e.g., semver, latest).
## @param postgres.standalone.resources Resource limits and requests for standalone PostgreSQL.
## @param postgres.cluster.instances Number of PostgreSQL instances (replicas).
## @param postgres.cluster.persistence.enabled Enable persistence for cluster PostgreSQL.
## @param postgres.cluster.persistence.size Size of the persistence volume.
## @param postgres.cluster.persistence.storageClass Storage class for persistence.
## @param postgres.cluster.image.repository PostgreSQL container image repository.
## @param postgres.cluster.persistence.enabled Enable persistence for cluster PostgreSQL.
## @param postgres.cluster.persistence.size Size of the persistence volume.
## @param postgres.cluster.persistence.storageClass Storage class for persistence.
## @param postgres.cluster.image.tag PostgreSQL container image tag.
## @param postgres.external.host Hostname of external PostgreSQL (when mode is 'external').
## @param postgres.external.port Port of external PostgreSQL.
##
postgres:
  mode: standalone
  type: postgresdb
  initSQL: []
    # - "CREATE EXTENSION IF NOT EXISTS pg_trgm;"

  username: n8n
  database: "n8n"

  # Secret configuration for database password
  # You must provide EITHER secretName (to use existing secret) OR value (to create new secret with password)
  password:
    secretName: ""  # Name of existing secret containing the password
    secretKey: "password"  # Key in the secret containing the password
    value: ""  # Direct password value (if secretName is empty, this must be provided)

  # Standalone PostgreSQL deployment (using StatefulSet)
  standalone:
    image:
      repository: postgres
      tag: "16-alpine"
      autoupdate:
        enabled: false
        updateStrategy: ""
    resources: {}


    persistence:
      enabled: true
      size: 512Mi
      storageClass: ""
      existingClaim: ""
  # CloudNativePG Cluster deployment
  cluster:
    persistence:
      enabled: true
      size: 512Mi
      storageClass: ""

    instances: 2
    image:
      repository: ghcr.io/cloudnative-pg/postgresql
      tag: "16"

  # External PostgreSQL configuration
  external:
    host: ""
    port: 5432

## @section ArgoCD Image Updater parameters

## @param imageUpdater.namespace Namespace where the ImageUpdater CRD will be created.
## @param imageUpdater.argocdNamespace Namespace where ArgoCD Applications are located.
## @param imageUpdater.applicationName Name or pattern of the ArgoCD Application to update. Defaults to Release name.
## @param imageUpdater.imageAlias Alias for the image in the ImageUpdater CRD. Defaults to Release name.
## @param imageUpdater.forceUpdate Force update even if image is not currently deployed.
## @param imageUpdater.helm Helm-specific configuration for parameter names (e.g., {name: "image.repository", tag: "image.tag"}).
## @param imageUpdater.kustomize Kustomize-specific configuration (e.g., {name: "original/image"}).
## @param imageUpdater.writeBackConfig Write-back configuration for GitOps.
##
imageUpdater:
  namespace: argocd
  argocdNamespace: argocd
  applicationName: ""
  imageAlias: ""
  forceUpdate: false
  helm: {}
  kustomize: {}
  writeBackConfig: {}
